{% extends "base.html" %}

{% block title %}Main Search{% endblock %}

{% block content %}
<h2 class="text-xl font-bold mb-4">WHAT DESTINATION?</h2>
<form action="{{ url_for('main_search') }}" method="post" class="flex mb-6">
    <input type="text" name="search" placeholder="Where do you want to go?" required
        class="w-full px-3 py-2 border rounded-l-md">
    <button type="submit" class="bg-blue-500 text-white px-4 rounded-r-md">Search</button>
</form>

<div class="mb-6 flex space-x-4">

    <!-- Carousel Container -->
    <div class="relative w-full overflow-hidden">
        <!-- Buttons Carousel -->
        <div id="carousel-buttons" class="flex transition-transform duration-500 space-x-4">
            {% for label in labels %}
            <a class="bg-gray-200 py-2 px-4 rounded-md whitespace-nowrap text-center" href="">{{label}}</a>
            {% endfor %}
        </div>

        <!-- Navigation Arrows with Padding -->
        <button id="prev-button"
            class="absolute left-2 top-1/2 -translate-y-1/2 bg-gray-300 p-2 rounded-full shadow-md focus:outline-none">
            &#8249;
        </button>
        <button id="next-button"
            class="absolute right-2 top-1/2 -translate-y-1/2 bg-gray-300 p-2 rounded-full shadow-md focus:outline-none">
            &#8250;
        </button>
    </div>

</div>

<h3 class="text-lg font-semibold mb-4">Most Visited</h3>
<div class="grid grid-cols-2 gap-4">
    {% for attraction in attractions %}
    <div class="bg-white shadow-md rounded-md overflow-hidden">
        <img src="https://images.unsplash.com/photo-1516738901171-8eb4fc13bd20?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8VHJpcCUyMHBsYW58ZW58MHx8MHx8fDA%3D"
            alt="{{ attraction.name }}" class="w-full h-32 object-cover">
        <div class="p-2">
            <h1 class="font-semibold"><a href="attraction?{{ attraction.id}}">{{ attraction.name }}</a></h1>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Carousel JavaScript -->
<script>
    const carousel = document.getElementById('carousel-buttons');
    const prevButton = document.getElementById('prev-button');
    const nextButton = document.getElementById('next-button');
    const buttons = carousel.children;
    const containerWidth = carousel.parentElement.offsetWidth;
    const buttonWidth = buttons[0].offsetWidth + 16; // Button width + space (Tailwind `space-x-4`)

    // Calculate how many times the buttons need to be cloned to fill up the carousel 4 times
    const totalButtons = buttons.length;
    const buttonsPerView = Math.ceil(containerWidth / buttonWidth);
    const clonesNeeded = buttonsPerView * 3; // We want the carousel to loop 3 times

    // Clone buttons dynamically
    for (let i = 0; i < clonesNeeded - totalButtons; i++) {
        const clone = buttons[i % totalButtons].cloneNode(true);
        carousel.appendChild(clone);
    }

    let scrollAmount = 0;

    prevButton.addEventListener('click', () => {
        scrollAmount -= buttonWidth;
        if (scrollAmount < 0) {
            scrollAmount = (clonesNeeded - buttonsPerView) * buttonWidth;
        }
        carousel.style.transform = `translateX(-${scrollAmount}px)`;
    });

    nextButton.addEventListener('click', () => {
        scrollAmount += buttonWidth;
        if (scrollAmount >= (clonesNeeded - buttonsPerView) * buttonWidth) {
            scrollAmount = 0;
        }
        carousel.style.transform = `translateX(-${scrollAmount}px)`;
    });
</script>
{% endblock %}